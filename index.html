<!DOCTYPE html>
<html lang="en">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-L64K6S2GBM"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-L64K6S2GBM');
</script>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="description" content="MindEye2: Shared-Subject Models Enable fMRI-To-Image With 1 Hour of Data">
  <meta name="keywords" content="fMRI,Stable Diffusion">
  <title>MindEye2: Shared-Subject Models Enable fMRI-To-Image With 1 Hour of Data</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="website_files/bootstrap.css">
  <script src="website_files/jquery.js"></script>
  <script src="website_files/bootstrap.js"></script>
  <style>
    /* Remove the navbar's default margin-bottom and rounded borders */ 
    .navbar {
      margin-bottom: 0;
      border-radius: 0;
    }
    
    /* Add a gray background color and some padding to the footer */
    footer {
      background-color: #f2f2f2;
      padding: 25px;
    }
    .long-image{
        width: 100%;
        height: 1000px;
        overflow: auto;
        margin: auto;
      }
  </style>
  <link rel="stylesheet" href="website_files/font.css">
  <link rel="stylesheet" href="website_files/main.css">
</head>
<body>

<div class="jumbotron"> 
  <div class="container text-center"> 
    <h1 style="color:white;margin-bottom:0;">MindEye2:</h1> 
    <h3 style="color:white;margin-top:0;">Shared-Subject Models Enable fMRI-To-Image With 1 Hour of Data</h3> 
    <br> 
    <p style="color:white"><a href="https://paulscotti.github.io">Paul S. Scotti</a><sup>1,2*</sup>, Mihir Tripathy<sup>†2</sup>, Cesar Kadir Torrico Villanueva<sup>†2</sup>, Reese Kneeland<sup>†3</sup>, Tong Chen<sup>4,2</sup>,
    Ashutosh Narang<sup>2</sup>, Charan Santhirasegaran<sup>2</sup>, Jonathan Xu<sup>5,2</sup>, Thomas Naselaris<sup>3</sup>, Kenneth A. Norman<sup>6</sup>,
    <a href="https://tanishq.ai">Tanishq Mathew Abraham</a><sup>1,2</sup>
    <br>
    <br>
    <br><sup>1</sup><a href="https://stability.ai">Stability AI</a>, <sup>2</sup><a href="https://medarc.ai">Medical AI Research Center (MedARC)</a>, 
    <sup>3</sup>University of Minnesota, <sup>4</sup>The University of Sydney, <sup>5</sup>University of Waterloo, <sup>6</sup>Princeton Neuroscience Institute. Correspondence to: Paul Scotti <scottibrain@gmail.com>.
    <br> (* indicate equal contribution, † indicates core contribution)
    <br>
  </div> 
</div>
  
<div class="container bg-3">    
  <div class="row text-center">
    <div class="col-sm-2"></div>
    <div class="col-sm-2 col-sm-offset-1">
      <a href="https://arxiv.org/"><img height="100" width="78" src="website_files/imgs/paper_page.png" data-nothumb="" style="border: 1px solid"><br>arXiv<br>Preprint<br></a>
    </div>
    <div class="col-sm-2">
      <a href="https://github.com/MedARC-AI/MindEyeV2"><img height="100" width="78" src="website_files/imgs/source_code.png" data-nothumb="" style="border: 1px solid"><br>Source Code<br>GitHub</a>
    </div>
    <div class="col-sm-2">
      <a href="#results"><img height="100" width="78" src="website_files/imgs/website_teaser.png" data-nothumb="" style="border: 1px solid"><br>Results</a>
    </div>
    <div class="col-sm-2 col-sm-offset-1"></div>
  </div>
</div><br>

  

<div class="container bg-3">
  <div class="row">
    <h2 class="text-center">Abstract</h2>
    <hr>
    <p> Reconstructions of visual perception from brain activity have improved tremendously, but the practical utility of such methods has been limited. This is because such models are trained independently per subject where each subject requires dozens of hours of expensive fMRI training data to attain high-quality results. The present work showcases high-quality reconstructions using only 1 hour of fMRI training data. We pretrain our model across 7 subjects and then fine-tune on minimal data from a new subject. Our novel functional alignment procedure linearly maps all brain data to a shared-subject latent space, followed by a shared non-linear mapping to CLIP image space. We then map from CLIP space to pixel space by fine-tuning Stable Diffusion XL to accept CLIP latents as inputs instead of text. This approach improves out-of-subject generalization with limited training data and also attains state-of-the-art image retrieval and reconstruction metrics compared to single-subject approaches. MindEye2 demonstrates how accurate reconstructions of perception are possible from a single visit to the MRI facility. All code is available on GitHub. </p>
    <div class="col-sm-12 text-center">
      <img src="website_files/imgs/figure1.png" class="img-fluid" alt="glide" style="width:88%">
    </div>
  </div>
</div><br>

<br><br>



<div class="container bg-3">
  <div class="row">
    <h2 class="text-center">Methods</h2>
    <hr>
    <p>
      MindEye2 is first trained using data from 7 subjects in the Natural Scenes Dataset and then fine-tuned using a target held-out subject who may have scarce training data. The fMRI activity is initially mapped to a shared-subject latent space via subject-specific ridge regression. The rest of the model is subject-agnostic, consisting of an MLP backbone and a diffusion prior which are used to output predicted CLIP [8,9] embeddings which are reconstructed into images using our SDXL unCLIP model. The diffusion prior helps bridge the modality gap between CLIP latent space and the fMRI latents generated by the MLP backbone. The alignment to shared-subject space is not trained independently—the whole pipeline is trained end-to-end where pretraining involves each batch containing brain inputs from all subjects.
    </p>
    <p>
      UnCLIP (or “image variations”) models have previously been used for the creative application of returning variations of a given reference image. Contrary to this, our goal was to train a model that returns images as close as possible to the reference image across both low-level structure and high-level semantics. For this use-case, we observed that existing unCLIP models do not accurately reconstruct images from their ground truth CLIP image embeddings (see above Figure). We therefore fine-tuned our own unCLIP model (using the 256 x 1664 dim. image embeddings from OpenCLIP ViT-bigG/14) from Stable Diffusion XL to support this goal, leading to much higher fidelity reconstructions from ground truth CLIP embeddings. For MindEye2, we can use OpenCLIP embeddings predicted from the brain instead of the ground truth embeddings to reconstruct images. This change increases the ceiling possible performance for fMRI-to-image reconstructions as it is no longer limited by the performance of the pre-trained frozen unCLIP model.
    </p>
    <div class="col-sm-12 text-center">
      <img src="website_files/imgs/pipeline.png" class="img-fluid" alt="glide" style="width:88%">
    </div>
  </div>
</div><br>


<div class="container bg-3">
  <div class="row">
    <h2 class="text-center" id="results">Results</h2>
    <hr>
     <p>
       <b>Image/Brain Retrieval</b> Image retrieval evaluations reveal the level of fine-grained image-specific information contained in the predicted brain embeddings. For example, 
       if the model is given a dozen pictures of zebras and the brain sample corresponding to viewing one of those zebras, can the model correctly find the corresponding zebra? 
       If the model can correctly deduce that the brain sample corresponds to an image of a zebra but cannot deduce the specific image amongst various candidates, this would suggest
       that category-level information but not exemplar-specific information is preserved in the CLIP fMRI embedding. MindEye not only succeeds in this zebra example but also 
       demonstrates 93.2% overall accuracy for Subject 1 in finding the exact original image within the 982 test images.
     </p>
    <p>
      We can scale up image retrieval using a pool of billions of image candidates. Below, we show results querying the LAION-5B dataset using our CLIP fMRI embeddings. The final layer
      CLIP ViT-L/14 embeddings for all 5 billion images are available at <a href="https://knn.laion.ai">knn.laion.ai</a>, and can be queried for K-nearest neighbor lookup via the 
      CLIP Retrieval client. For each test sample, we first retrieve 16 candidate images using this method (using a variant of MindEye that maps voxels to the final layer of CLIP). 
      The best image is then selected based on having the highest CLIP embedding cosine similarity to the CLIP fMRI embedding. This image retrieval approach is especially well-suited for 
      tasks involving fine-grained classification, and can be used as an alternative to image reconstruction without a generative model.
    <div class="col-sm-12 text-center">
      <img src="website_files/imgs/retrieval.png" class="img-fluid" alt="glide" style="width:88%">
    </div>
  </div>

  <div class="row">
    <hr>
    <p>
      <b>fMRI-to-Image Reconstruction</b> The diffusion prior outputs from MindEye are aligned CLIP fMRI embeddings that can be used with any pretrained image generation model 
      that accepts latents from CLIP image space. We evaluated the outputs of MindEye reconstructions across several models including Versatile Diffusion, Stable Diffusion 
      (Image Variations) and Lafite. Here we show results from Versatile Diffusion since it yielded the best results. For each subject, for each test brain sample, we output 
      16 CLIP image embeddings from MindEye and feed these embeddings through the image variations pipeline of Versatile Diffusion. This produces 16 image reconstructions 
      per brain sample. For our reconstructions we use 20 denoising timesteps with UniPCMultistep noise scheduling and start the denoising process from the noised output of our
      low-level pipeline (img2img). We then select the best of 16 reconstructions by computing last hidden layer CLIP embeddings and picking the image with the highest cosine 
      similarity to the disjointed CLIP fMRI embedding. We qualitatively compare our reconstructions side-by-side with outputs from other fMRI-to-image reconstruction models below.
    </p>
    <div class="col-sm-12 text-center">
      <img src="website_files/imgs/recon_comparison.png" class="img-fluid" alt="clevr_objects" style="width:100%; height:100%">
    </div>
  </div>
</div><br><br>

<div class="container bg-3">
  <div class="row">
    <h2 class="text-center">Acknowledgements</h2>
    <hr>
    <p> Special thanks to Dustin Podell, Vikram Voleti, Andreas Blattmann, and Robin Rombach for technical assistance fine-tuning Stable Diffusion XL to support our unCLIP usecase. Thanks to the MedARC Discord community for being the public forum from which this research was developed, particularly thank you to Connor Lane, Alex Nguyen, Atmadeep Bannerjee, Amir Refaee, and Mohammed Baharoon for their helpful discussions. Thanks to Alessandro Gifford and Connor Lane for providing useful feedback on drafts of the manuscript. Thank you to Richard Vencu for help navigating the Stability AI HPC. Thanks to Stability AI for their support for open neuroAI research and providing the computational resources necessary to develop MindEye2. Collection of the Natural Scenes Dataset was supported by NSF IIS-1822683 and NSF IIS-1822929. This webpage template was recycled from <a href="https://energy-based-model.github.io/Compositional-Visual-Generation-with-Composable-Diffusion-Models/">here</a>. 
    </p>
  </div>
</div><br><br>


</body>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</html>
